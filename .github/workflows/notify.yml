name: SKIMA watcher

on:
  workflow_dispatch: 
    inputs:
      reason:
        description: Called by Deno.cron
        required: false

jobs:
  run:
    runs-on: ubuntu-latest
    # 同時実行を避ける◆
    concurrency:
      group: skima-watch
      cancel-in-progress: false
    steps:
      - uses: actions/checkout@v4

      - uses: actions/setup-python@v5
        with:
          python-version: "3.12"

      - run: pip install requests beautifulsoup4

      # shelve の DB をキャッシュ◆
      - id: hash
        run: |
          echo "filehash=$(sha256sum .cache/items.db | cut -d' ' -f1)" >> $GITHUB_OUTPUT
      
      - uses: actions/cache@v4
        with:
          path: .cache
          key: skima-watch-cache${{ steps.hash.outputs.filehash }}
          restore-keys: skima-watch-cache

      - run: python skima_watch.py
        env:
          IFTTT_KEY: ${{ secrets.IFTTT_KEY }}


